<h1><%= @challenge.name %></h1>
<p class="text-muted">
  <strong>Dates:</strong> <%= @challenge.start_date %> – <%= @challenge.end_date %> |
  <strong>Owner:</strong> <%= @challenge.owner.name.presence || @challenge.owner.email %> |
  <strong>Status:</strong> <%= @challenge.status %> |
  <strong>Frequency:</strong> <%= @challenge.frequency %>
</p>


<% if user_signed_in? %>
  <% if @challenge.participations.exists?(user: current_user) %>
    <%= button_to "Salir del challenge",
                  leave_challenge_path(@challenge),
                  method: :delete,
                  form: { "data-turbo" => "false" },
                  class: "btn btn-outline-danger mt-2" %>
  <% else %>
    <%= button_to "Participar en este challenge",
                  join_challenge_path(@challenge),
                  method: :post,
                  form: { "data-turbo" => "false" },
                  class: "btn btn-success mt-2" %>
  <% end %>
<% else %>
  <p class="text-muted mt-2">
    Inicia sesión para participar en este challenge.
  </p>
<% end %>


<div class="mt-3 d-flex gap-2">

<% if can?(:update, @challenge) %>
  <%= link_to "Editar", edit_challenge_path(@challenge), class: "btn btn-outline-primary" %>
<% end %>

<% if can?(:destroy, @challenge) %>
  <%= button_to "Eliminar", @challenge,
      method: :delete,
      form: { data: { turbo: false } },
      onclick: "return confirm('¿Seguro que deseas eliminar este challenge?');",
      class: "btn btn-outline-danger" %>
<% end %>
  <%= link_to "Volver", challenges_path, class: "btn btn-secondary ms-auto" %>
</div>



<p><%= simple_format(@challenge.description) %></p>

<h4 class="mt-4">Participants</h4>
<ul class="list-group mb-3">
  <% @challenge.participants.each do |u| %>
    <% part = @challenge.participations.find { |p| p.user_id == u.id } %>
    <li class="list-group-item d-flex justify-content-between align-items-center">
      <%= link_to (u.name.presence || u.email), u %>
      <span>
        <span class="badge text-bg-secondary me-2"><%= part&.role || "participant" %></span>
        <span class="badge text-bg-primary"><%= part&.total_points || 0 %> pts</span>
      </span>
    </li>
  <% end %>
</ul>

<p>
  <strong>Tags:</strong>
  <% @challenge.tags.each do |t| %>
    <span class="badge text-bg-secondary"><%= t.name %></span>
  <% end %>
</p>
