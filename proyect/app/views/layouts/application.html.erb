<!DOCTYPE html>
<html>
  <head>
    <title>FitChallenge</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "application", defer: true %>

    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"> -->
  </head>


  <body class="bg-light min-vh-100 d-flex flex-column">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand fw-bold" href="/">FitChallenge</a>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMain">
      <div class="navbar-nav me-auto">
          <%= link_to "Challenges", challenges_path, class: "nav-link" %>
          <%= link_to "Users", users_path, class: "nav-link" %>
          <%= link_to "Badges", badges_path, class: "nav-link" %>

          <% if user_signed_in? %>
            <%= link_to "Tags", tags_path, class: "nav-link" %>
            <%= link_to "Notifications", notifications_path, class: "nav-link" %>
            <% if can?(:read, Participation) %>
            <%= link_to "Participations", participations_path, class: "nav-link" %>
            <% end %>
            <%= link_to "Progress Entries", progress_entries_path, class: "nav-link" %>
          <% end %>
        </div>

        <div class="ms-auto d-flex align-items-center gap-3">
        <% if user_signed_in? %>
          <span class="navbar-text mb-0 text-light">
            Hola, <strong><%= current_user.username.presence || current_user.email %></strong>
          </span>

          <%= link_to "Mi perfil",
                      user_path(current_user),
                      class: "nav-link text-light" %>

          <%= button_to "Cerrar sesión",
                        destroy_user_session_path,
                        method: :delete,
                        form: { "data-turbo" => "false", class: "d-inline" },
                        class: "nav-link text-light p-0" %>
        <% else %>
          <%= link_to "Registrarse",
                      new_user_registration_path,
                      class: "nav-link text-light" %>

          <%= link_to "Iniciar sesión",
                      new_user_session_path,
                      class: "nav-link text-light" %>
        <% end %>
      </div>
    </div>
  </div>
</nav>

    <!-- Contenido principal -->
    <main class="container my-4 flex-grow-1">
    <% flash.each do |key, value| %>
  <% css = case key.to_s
           when "notice" then "alert alert-success"
           when "alert"  then "alert alert-warning"
           else "alert alert-info"
           end %>
  <div class="<%= css %> my-2" role="alert">
    <%= value %>
  </div>
<% end %>

      <%= yield %>
    </main>

    <!-- Footer global -->
    <footer class="bg-dark text-white-50 py-3 mt-auto">
      <div class="container d-flex flex-wrap justify-content-between align-items-center gap-2">
        <span>&copy; <%= Time.current.year %> FitChallenge - Grupo 2</span>
      </div>
    </footer>

    <!-- CDN de Bootstrap JS -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script> -->
  </body>
</html>
